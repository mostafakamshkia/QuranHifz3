<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÙˆØ±Ø¯Ø¯ | ØµÙØ­Ø© Ø§Ù„Ø³ÙˆØ±Ø©</title>

  <!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --space-dark: #0f172a;
      --space-light: #1e293b;
      --text-light: #e2e8f0;
      --text-muted: #94a3b8;
      --accent-glow: #facc15;
      --primary-glow: #a78bfa;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Tajawal", system-ui, sans-serif;
      background-color: var(--space-dark);
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      overflow: hidden; /* Ù„Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± scrollbars Ø¨Ø³Ø¨Ø¨ Ø§Ù„ÙƒÙˆÙ†ÙÙŠØªÙŠ */
    }

    .container {
      width: min(900px, 90vw);
      z-index: 10;
      position: relative;
    }
    
    .surah-header {
        margin-bottom: 24px;
    }

    .surah-header h1 {
      font-size: clamp(2rem, 10vw, 3.5rem); /* Ø­Ø¬Ù… Ø®Ø· Ù…ØªØ¬Ø§ÙˆØ¨ */
      font-weight: 800;
      color: var(--accent-glow);
    }
    
    .surah-header p {
      font-size: 1.1rem;
      color: var(--text-muted);
    }

    .main-content {
        background-color: var(--space-light);
        border: 1px solid #334155;
        border-radius: 24px;
        padding: 40px 20px;
        margin-bottom: 32px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 24px;
    }

    .main-content .placeholder-icon {
        font-size: 80px;
    }

    .player-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        width: 100%;
        margin-top: 20px;
    }

    .nav-btn, .play-btn {
        background: var(--space-dark);
        border: 1px solid #475569;
        color: var(--text-light);
        border-radius: 50%;
        width: 60px;
        height: 60px;
        font-size: 28px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .play-btn {
        width: 80px;
        height: 80px;
        font-size: 40px;
        background: var(--primary-glow);
        border: none;
    }

    .nav-btn:hover, .play-btn:hover {
        transform: scale(1.1);
        border-color: var(--accent-glow);
    }
    
    .nav-btn.disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
        border-color: #475569;
    }

    .back-button {
      display: inline-block;
      margin-top: 16px;
      color: var(--text-muted);
      text-decoration: none;
      font-weight: 500;
    }
    .back-button:hover {
        color: var(--text-light);
    }

    #celebrationCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø®Ù„ÙÙ‡Ø§ */
      z-index: 100;
    }
  </style>
</head>
<body>
  
  <canvas id="celebrationCanvas"></canvas>

  <div class="container">
    <header class="surah-header">
      <h1 id="surahNameEl"></h1>
      <p id="welcomeMessageEl"></p>
    </header>
    
    <main class="main-content">
        <div class="placeholder-icon">ğŸ“–</div>
        <p>Ø§Ø³ØªÙ…Ø¹ ÙˆÙƒØ±Ø± Ø§Ù„Ø¢ÙŠØ§Øª Ù…Ø¹ Ø§Ù„Ø´ÙŠØ®</p>
        <audio id="audioPlayer" loop></audio>
        
        <div class="player-controls">
            <a id="prevBtn" class="nav-btn" href="#">&#x25B6;</a> <!-- Ø§Ù„Ø³Ù‡Ù… Ù…Ø¹ÙƒÙˆØ³ Ø¨Ø§Ù„Ù€ CSS -->
            <button id="playPauseBtn" class="play-btn">â–¶</button>
            <a id="nextBtn" class="nav-btn" href="#">&#x25C0;</a> <!-- Ø§Ù„Ø³Ù‡Ù… Ù…Ø¹ÙƒÙˆØ³ Ø¨Ø§Ù„Ù€ CSS -->
        </div>
    </main>

    <a href="index.html" class="back-button">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙÙ‡Ø±Ø³</a>
  </div>

  <script>
    // â€”â€” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆØ± (Ù…Ù‡Ù…Ø© Ù„Ù„ØªÙ†Ù‚Ù„) â€”â€”
    const JUZ_30 = [{num:78,name:'Ø§Ù„Ù†Ø¨Ø£'},{num:79,name:'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª'},{num:80,name:'Ø¹Ø¨Ø³'},{num:81,name:'Ø§Ù„ØªÙƒÙˆÙŠØ±'},{num:82,name:'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±'},{num:83,name:'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†'},{num:84,name:'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚'},{num:85,name:'Ø§Ù„Ø¨Ø±ÙˆØ¬'},{num:86,name:'Ø§Ù„Ø·Ø§Ø±Ù‚'},{num:87,name:'Ø§Ù„Ø£Ø¹Ù„Ù‰'},{num:88,name:'Ø§Ù„ØºØ§Ø´ÙŠØ©'},{num:89,name:'Ø§Ù„ÙØ¬Ø±'},{num:90,name:'Ø§Ù„Ø¨Ù„Ø¯'},{num:91,name:'Ø§Ù„Ø´Ù…Ø³'},{num:92,name:'Ø§Ù„Ù„ÙŠÙ„'},{num:93,name:'Ø§Ù„Ø¶Ø­Ù‰'},{num:94,name:'Ø§Ù„Ø´Ø±Ø­'},{num:95,name:'Ø§Ù„ØªÙŠÙ†'},{num:96,name:'Ø§Ù„Ø¹Ù„Ù‚'},{num:97,name:'Ø§Ù„Ù‚Ø¯Ø±'},{num:98,name:'Ø§Ù„Ø¨ÙŠÙ†Ø©'},{num:99,name:'Ø§Ù„Ø²Ù„Ø²Ù„Ø©'},{num:100,name:'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª'},{num:101,name:'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©'},{num:102,name:'Ø§Ù„ØªÙƒØ§Ø«Ø±'},{num:103,name:'Ø§Ù„Ø¹ØµØ±'},{num:104,name:'Ø§Ù„Ù‡Ù…Ø²Ø©'},{num:105,name:'Ø§Ù„ÙÙŠÙ„'},{num:106,name:'Ù‚Ø±ÙŠØ´'},{num:107,name:'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†'},{num:108,name:'Ø§Ù„ÙƒÙˆØ«Ø±'},{num:109,name:'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†'},{num:110,name:'Ø§Ù„Ù†ØµØ±'},{num:111,name:'Ø§Ù„Ù…Ø³Ø¯'},{num:112,name:'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ'},{num:113,name:'Ø§Ù„ÙÙ„Ù‚'},{num:114,name:'Ø§Ù„Ù†Ø§Ø³'}];
    const JUZ_29 = [{num:67,name:'Ø§Ù„Ù…Ù„Ùƒ'},{num:68,name:'Ø§Ù„Ù‚Ù„Ù…'},{num:69,name:'Ø§Ù„Ø­Ø§Ù‚Ø©'},{num:70,name:'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬'},{num:71,name:'Ù†ÙˆØ­'},{num:72,name:'Ø§Ù„Ø¬Ù†'},{num:73,name:'Ø§Ù„Ù…Ø²Ù…Ù„'},{num:74,name:'Ø§Ù„Ù…Ø¯Ø«Ø±'},{num:75,name:'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©'},{num:76,name:'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†'},{num:77,name:'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª'}];

    // â€”â€” Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© â€”â€”
    const surahNameEl = document.getElementById('surahNameEl');
    const welcomeMessageEl = document.getElementById('welcomeMessageEl');
    const audioPlayer = document.getElementById('audioPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // â€”â€” Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙØ­Ø© â€”â€”
    window.onload = function() {
      const params = new URLSearchParams(window.location.search);
      const surahNum = params.get('num');
      const surahName = params.get('name');
      const juz = params.get('juz');
      const gender = params.get('gender');

      if (!surahNum || !surahName) {
        surahNameEl.textContent = "Ø®Ø·Ø£";
        welcomeMessageEl.textContent = "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³ÙˆØ±Ø©. Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø±Ø¬Ø¹ Ù„Ù„ÙÙ‡Ø±Ø³ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        return;
      }

      // 1. ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙØ­Ø©
      document.title = `ÙˆØ±Ø¯Ø¯ | ${surahName}`;
      surahNameEl.textContent = `Ø³ÙˆØ±Ø© ${surahName}`;
      const heroType = gender === 'boy' ? 'Ø§Ù„ÙØ§Ø±Ø³' : 'Ø§Ù„ÙØ§Ø±Ø³Ø©';
      welcomeMessageEl.textContent = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ ${heroType} Ø§Ù„ØµØºÙŠØ±ØŒ Ù„Ù†Ù‚Ø±Ø£ Ùˆ Ù†Ø±Ø¯Ø¯ Ø³ÙˆÙŠØ§Ù‹.`;

      // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª (Ø§Ù„Ø´ÙŠØ® Ø§Ù„Ø­ØµØ±ÙŠ - Ø§Ù„Ù…Ø¹Ù„Ù…)
      audioPlayer.src = `https://download.quranicaudio.com/quran/hussary_muallim/${surahNum}.mp3`;
      
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
      playAudio();

      // 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
      const surahList = juz === '30' ? JUZ_30 : JUZ_29;
      const currentIndex = surahList.findIndex(s => s.num == surahNum);

      // Ø²Ø± Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
      if (currentIndex > 0) {
        const prevSurah = surahList[currentIndex - 1];
        const prevParams = new URLSearchParams({ ...Object.fromEntries(params), num: prevSurah.num, name: prevSurah.name });
        prevBtn.href = `surah.html?${prevParams.toString()}`;
      } else {
        prevBtn.classList.add('disabled');
        prevBtn.onclick = (e) => e.preventDefault();
      }

      // Ø²Ø± Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
      if (currentIndex < surahList.length - 1) {
        const nextSurah = surahList[currentIndex + 1];
        const nextParams = new URLSearchParams({ ...Object.fromEntries(params), num: nextSurah.num, name: nextSurah.name });
        nextBtn.href = `surah.html?${nextParams.toString()}`;
        // ** ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· **
        nextBtn.addEventListener('click', (e) => {
            e.preventDefault(); // Ù†Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ
            triggerCelebration();
            // Ù†Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ù†Ù†ØªÙ‚Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
            setTimeout(() => { window.location.href = nextBtn.href; }, 800);
        });
      } else {
        nextBtn.classList.add('disabled');
        nextBtn.onclick = (e) => e.preventDefault();
      }
    };

    // 4. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ ÙˆØ§Ù„Ø¥ÙŠÙ‚Ø§Ù - ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ÙƒØªØ§Ø¨ØªÙ‡ Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    async function playAudio() {
      if (!audioPlayer.src) return;
      try {
        await audioPlayer.play();
      } catch (err) {
        if (err.name !== 'AbortError') {
          console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", err);
        }
      }
    }

    function pauseAudio() {
      audioPlayer.pause();
    }
    
    playPauseBtn.addEventListener('click', () => {
      if (audioPlayer.paused) {
        playAudio();
      } else {
        pauseAudio();
      }
    });

    audioPlayer.addEventListener('play', () => {
      playPauseBtn.textContent = 'â¸';
    });

    audioPlayer.addEventListener('pause', () => {
      playPauseBtn.textContent = 'â–¶';
    });
    
    // 5. Ù…Ù†Ø·Ù‚ Ø§Ø­ØªÙØ§Ù„ÙŠØ© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² (ÙÙ‚Ø§Ø¹Ø§Øª)
    const canvas = document.getElementById('celebrationCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    
    function triggerCelebration() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        particles = [];
        const particleCount = 200;
        const colors = ['#facc15', '#a78bfa', '#f472b6', '#38bdf8', '#e2e8f0'];

        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: canvas.height + Math.random() * 300, // ØªØ¨Ø¯Ø£ Ù…Ù† Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
                radius: Math.random() * 5 + 2,
                color: colors[Math.floor(Math.random() * colors.length)],
                speed: Math.random() * 5 + 2,
                alpha: 1
            });
        }
        animateCelebration();
    }

    function animateCelebration() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        particles.forEach((p, index) => {
            p.y -= p.speed;
            p.alpha -= 0.01;

            if (p.alpha <= 0) {
                particles.splice(index, 1);
            }

            ctx.beginPath();
            ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${hexToRgb(p.color)}, ${p.alpha})`;
            ctx.fill();
        });

        if (particles.length > 0) {
            requestAnimationFrame(animateCelebration);
        } else {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    }

    function hexToRgb(hex) {
        let r = 0, g = 0, b = 0;
        if (hex.length == 4) {
            r = "0x" + hex[1] + hex[1];
            g = "0x" + hex[2] + hex[2];
            b = "0x" + hex[3] + hex[3];
        } else if (hex.length == 7) {
            r = "0x" + hex[1] + hex[2];
            g = "0x" + hex[3] + hex[4];
            b = "0x" + hex[5] + hex[6];
        }
        return `${+r},${+g},${+b}`;
    }

  </script>
</body>
</html>

